---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'fs';
import path from 'path';

export async function getStaticPaths() {
  const dataPath = path.join(process.cwd(), 'recipe-data', 'all-recipes.json');
  const data = JSON.parse(fs.readFileSync(dataPath, 'utf-8'));

  return data.collections.map((collection: any) => {
    // Load the full collection data
    const collectionPath = path.join(process.cwd(), 'recipe-data', `${collection.slug}.json`);
    const collectionData = JSON.parse(fs.readFileSync(collectionPath, 'utf-8'));

    return {
      params: { slug: collection.slug },
      props: { collection: collectionData },
    };
  });
}

const { slug } = Astro.params;
const { collection } = Astro.props;

// Icon SVGs for collections
const collectionIcons: Record<string, string> = {
  'quick-weeknight-dinners': '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2m6-2a10 10 0 11-20 0 10 10 0 0120 0z" /></svg>',
  'baking-basics': '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v4m0 0c-2 0-4 2-4 5s2 5 4 5 4-2 4-5-2-5-4-5zm0 14v4m-3-4h6" /></svg>',
  'one-pot-meals': '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 10h16v9a2 2 0 01-2 2H6a2 2 0 01-2-2v-9zm0 0V8a2 2 0 012-2h12a2 2 0 012 2v2M8 6V4m8 2V4m-4 2V3" /></svg>',
  'healthy-lunches': '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 20c0-7 5-13 14-14-1 9-7 14-14 14zm0 0v-4m7-3c-3 0-5 2-7 7" /></svg>',
  'comfort-food-classics': '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>',
};
const defaultIcon = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>';

const icon = collectionIcons[slug!] || defaultIcon;
---

<BaseLayout
  title={`${collection.theme.name} - Simpler Recipes`}
  description={collection.theme.description}
>
  <main id="main-content" class="min-h-screen bg-background">
    <div class="max-w-[1080px] mx-auto px-4 py-8 md:py-12">
      <nav class="mb-8">
        <a
          href="/"
          class="inline-flex items-center text-sand-600 hover:text-sand-900 transition-colors text-sm"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7" />
          </svg>
          <span class="ml-1">Back</span>
        </a>
      </nav>

      <header class="flex items-start gap-4 mb-10">
        <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-sand-200/60 flex items-center justify-center text-sand-600">
          <Fragment set:html={icon} />
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-medium tracking-tight-headline text-sand-900 mb-1">
            {collection.theme.name}
          </h1>
          <p class="text-sand-600 text-sm">
            {collection.theme.description}
          </p>
          <p class="text-sand-400 text-xs mt-2">
            {collection.metadata.recipeCount} recipes
          </p>
        </div>
      </header>

      <section aria-label="Recipes in this collection">
        <ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {collection.recipes.map((recipe: any) => (
            <li>
              <a
                href={`/recipes/${recipe.slug}`}
                class="block h-full bg-sand-50 rounded-xl overflow-hidden hover:bg-sand-100/80 transition-all group"
              >
                <article>
                  {recipe.image ? (
                    <div class="aspect-[4/3] overflow-hidden bg-sand-200">
                      <img
                        src={recipe.image}
                        alt=""
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                        loading="lazy"
                      />
                    </div>
                  ) : (
                    <div class="aspect-[4/3] bg-sand-200 flex items-center justify-center">
                      <svg class="w-8 h-8 text-sand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                    </div>
                  )}
                  <div class="p-4">
                    <h2 class="text-sand-900 font-medium text-sm group-hover:text-sand-950 transition-colors mb-2 line-clamp-2">
                      {recipe.title}
                    </h2>
                    <div class="flex flex-wrap items-center gap-2">
                      {recipe.totalTime && (
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-sand-200/60 text-sand-600 text-xs">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2m6-2a10 10 0 11-20 0 10 10 0 0120 0z" />
                          </svg>
                          {recipe.totalTime}
                        </span>
                      )}
                      {recipe.servings && (
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-sand-200/60 text-sand-600 text-xs">
                          {recipe.servings} servings
                        </span>
                      )}
                    </div>
                  </div>
                </article>
              </a>
            </li>
          ))}
        </ul>
      </section>
    </div>
  </main>
</BaseLayout>
